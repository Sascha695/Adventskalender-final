<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Adventskalender Tag 6 ‚Äì Wortsuppe</title>
  <style>
    :root{
      --accent: #d64545;
      --found: #1d9e57;
      --grid-size: 15; /* 15x15 */
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f7efe6;
      color:#222;
    }

    header{
      text-align:center;
      background:#c54c3d;
      color:#fff;
      padding:1rem .75rem;
      box-shadow:0 2px 20px rgba(0,0,0,.12) inset;
    }
    header h1{margin:0;font-size:2rem}

    main{
      max-width:1000px;
      margin: 1rem auto 2rem;
      padding: 1rem;
    }

    .wrap{
      display:grid;
      grid-template-columns: 1fr min(92vw, 520px);
      gap:1rem;
      align-items:start;
    }
    @media (max-width: 900px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      background: rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
      border:1px solid rgba(0,0,0,.08);
      border-radius:16px;
      box-shadow:0 8px 20px rgba(0,0,0,.12);
      padding:1rem;
    }

    .words h2{margin:.2rem 0 .5rem}
    .words ul{
      list-style:none; padding:0; margin:0;
      columns: 2; column-gap:1rem;
    }
    @media (max-width: 480px){ .words ul{ columns:1; } }
    .words li{
      padding:.25rem .4rem;
      border-radius:8px;
      break-inside: avoid-column;
    }
    .words li.found{
      color: var(--found);
      text-decoration: line-through;
      font-weight:700;
    }

    /* GRID */
    .grid{
      user-select:none;
      touch-action:none;
      display:grid;
      grid-template-columns: repeat(var(--grid-size), 1fr);
      grid-template-rows: repeat(var(--grid-size), 1fr);
      width: min(92vw, 520px);
      aspect-ratio: 1/1;
      background:#000;
      border-radius:12px;
      overflow:hidden;
    }
    .cell{
      display:flex; align-items:center; justify-content:center;
      font: 700 1.05rem/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#fff8ee;
      position:relative;
    }
    .cell + .cell{ box-shadow: inset 1px 0 0 rgba(0,0,0,.25); }
    .cell{ box-shadow: inset 0 1px 0 rgba(0,0,0,.25), inset 1px 0 0 rgba(0,0,0,.25); }

    /* Live-Auswahl */
    .cell.preview{
      background: #ffe3d7;
    }
    /* Gefundene Pfade */
    .cell.locked{
      background: #e8fbf0;
    }

    .bar{
      text-align:center; margin-top: .8rem;
    }
    .btn{
      appearance:none;border:none;cursor:pointer;
      background: var(--accent); color:#fff;
      padding:.6rem 1rem; border-radius:10px; font-weight:700;
      box-shadow:0 4px 14px rgba(0,0,0,.2);
    }
    .msg{ display:block; margin-top:.5rem; color:#333; font-weight:600; }
  </style>
</head>
<body>
  <header>
    <h1>Tag 6 ‚Äì Wortsuppe (Weihnachten)</h1>
  </header>

  <main>
    <div class="wrap">
      <!-- Wortliste -->
      <section class="card words">
        <h2>Finde diese W√∂rter (r√ºckw√§rts ist auch erlaubt):</h2>
        <ul id="wordList"></ul>
        <div class="bar">
          <button class="btn" id="resetBtn">Zur√ºcksetzen</button>
          <span class="msg" id="statusMsg"></span>
        </div>
      </section>

      <!-- Gitter -->
      <section class="card">
        <div id="grid" class="grid" aria-label="Wortsuppe"></div>
      </section>
    </div>
  </main>

  <script>
    /***********************
     * 1) Wortliste (anpassen)
     ***********************/
    const WORDS = [
      "GESCHENK","DREIKOENIGE","NORDPOL","RAUCHFANG","KRIPPE","ADVENTSKRANZ",
      "LEBKUCHEN","GLOCKEN","SCHLITTEN","ORNAMENT","SCHNEEMANN","WUNSCHLISTE",
      "SCHLEIFE","TRUTHAN","KEKSE","SCHNEE","ELF","STERN","STECHPALME","RENTIER",
      "KERZE","TANNENBAUM","NIKOLAUS","KRANZ","PLAETZCHEN","MISTEL","KAMIN",
      "KUGELN","WEIHNACHT","ENGEL"
    ];
    // Hinweis: Umlaute als AE/UE/OE, damit Tastatur einfacher ist.
    // Anzeige bleibt in Gro√übuchstaben.

    const SIZE = 15; // 15x15
    const gridEl = document.getElementById('grid');
    const wordListEl = document.getElementById('wordList');
    const statusMsg = document.getElementById('statusMsg');
    const resetBtn = document.getElementById('resetBtn');

    /***********************
     * 2) Hilfsfunktionen
     ***********************/
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ñ√ñ√ú";
    const rnd = (n) => Math.floor(Math.random() * n);

    // Richtungen (dx, dy)
    const DIRS = [
      [1,0],[-1,0],[0,1],[0,-1], [1,1],[-1,-1],[1,-1],[-1,1]
    ];

    function inBounds(x,y){ return x>=0 && x<SIZE && y>=0 && y<SIZE; }

    /***********************
     * 3) Grid & Platzierung
     ***********************/
    function emptyGrid(){
      return Array.from({length: SIZE}, () => Array(SIZE).fill(null));
    }

    function tryPlace(grid, word){
      // Versuche, das Wort zuf√§llig zu platzieren (mehrfach)
      for(let t=0; t<200; t++){
        const dir = DIRS[rnd(DIRS.length)];
        const len = word.length;
        const startX = rnd(SIZE);
        const startY = rnd(SIZE);
        const endX = startX + dir[0]*(len-1);
        const endY = startY + dir[1]*(len-1);
        if(!inBounds(endX,endY)) continue;

        // Kollision checken
        let ok = true;
        for(let i=0;i<len;i++){
          const x = startX + dir[0]*i, y = startY + dir[1]*i;
          const cell = grid[y][x];
          if(cell && cell !== word[i]) { ok = false; break; }
        }
        if(!ok) continue;

        // Eintragen
        for(let i=0;i<len;i++){
          const x = startX + dir[0]*i, y = startY + dir[1]*i;
          grid[y][x] = word[i];
        }
        // Koordinaten speichern (f√ºr Erfolgskontrolle)
        return {start:[startX,startY], end:[endX,endY]};
      }
      return null;
    }

    function buildGrid(words){
      const grid = emptyGrid();
      const placed = [];
      for(const raw of words){
        const w = raw.replace(/\s+/g,'').toUpperCase();
        // manchmal r√ºckw√§rts einbauen:
        const word = Math.random()<0.5 ? w : [...w].reverse().join('');
        const p = tryPlace(grid, word);
        if(p){
          placed.push({ word: w, coords: p, placed: word });
        } else {
          console.warn('Konnte nicht platzieren:', w);
        }
      }
      // Rest mit Zufallsbuchstaben
      for(let y=0;y<SIZE;y++)
        for(let x=0;x<SIZE;x++)
          if(!grid[y][x]) grid[y][x] = letters[rnd(letters.length)];
      return {grid, placed};
    }

    /***********************
     * 4) Rendering
     ***********************/
    let data, foundWords, cellEls;

    function render(){
      gridEl.style.setProperty('--grid-size', SIZE);
      gridEl.innerHTML = '';
      cellEls = [];

      for(let y=0;y<SIZE;y++){
        for(let x=0;x<SIZE;x++){
          const d = document.createElement('div');
          d.className = 'cell';
          d.dataset.x = x; d.dataset.y = y;
          d.textContent = data.grid[y][x];
          gridEl.appendChild(d);
          cellEls.push(d);
        }
      }

      wordListEl.innerHTML = '';
      for(const w of WORDS){
        const li = document.createElement('li');
        li.textContent = w;
        li.id = 'w_' + w;
        wordListEl.appendChild(li);
      }
    }

    /***********************
     * 5) Auswahl per Ziehen/Wischen
     ***********************/
    let selecting = false;
    let startCell = null;
    let previewCells = [];

    function cellFromEvent(ev){
      const t = ev.target.closest('.cell');
      if(!t) return null;
      return { x: +t.dataset.x, y: +t.dataset.y, el: t };
    }

    function clearPreview(){
      previewCells.forEach(el => el.classList.remove('preview'));
      previewCells = [];
    }

    function lineCells(x0,y0,x1,y1){
      const dx = Math.sign(x1 - x0);
      const dy = Math.sign(y1 - y0);
      // muss gerade oder diagonal sein
      if(dx!==0 && dy!==0 && Math.abs(x1-x0)!==Math.abs(y1-y0)) return [];
      const cells = [];
      let x=x0, y=y0;
      while(true){
        cells.push({x,y});
        if(x===x1 && y===y1) break;
        x += dx; y += dy;
      }
      return cells;
    }

    function lettersOf(cells){
      return cells.map(({x,y}) => data.grid[y][x]).join('');
    }

    function lockCells(cells){
      cells.forEach(({x,y})=>{
        const idx = y*SIZE + x;
        gridEl.children[idx].classList.add('locked');
      });
    }

    function markWordFound(word){
      foundWords.add(word);
      const li = document.getElementById('w_' + word);
      if(li) li.classList.add('found');
      statusMsg.textContent = `${foundWords.size}/${WORDS.length} gefunden`;
    }

    function onPointerDown(ev){
      const c = cellFromEvent(ev);
      if(!c) return;
      selecting = true;
      startCell = c;
      clearPreview();
      c.el.classList.add('preview');
      previewCells = [c.el];
      ev.preventDefault();
    }

    function onPointerMove(ev){
      if(!selecting || !startCell) return;
      const c = cellFromEvent(ev);
      if(!c) return;

      clearPreview();

      const cells = lineCells(startCell.x, startCell.y, c.x, c.y);
      for(const {x,y} of cells){
        const idx = y*SIZE + x;
        const el = gridEl.children[idx];
        el.classList.add('preview');
        previewCells.push(el);
      }
    }

    function onPointerUp(ev){
      if(!selecting || !startCell){ selecting=false; return; }
      const c = cellFromEvent(ev) || startCell;

      const cells = lineCells(startCell.x, startCell.y, c.x, c.y);
      const sel = lettersOf(cells);
      const selRev = [...sel].reverse().join('');

      // Pr√ºfen gegen echte W√∂rter
      // (wir vergleichen gegen ‚ÄûW‚Äú in normaler Schreibweise ohne Reverse)
      let matched = null;
      for(const w of WORDS){
        if(foundWords.has(w)) continue;
        if(sel === w || selRev === w){ matched = w; break; }
      }

      if(matched){
        lockCells(cells);
        markWordFound(matched);
      }

      clearPreview();
      selecting = false;
      startCell = null;

      if(foundWords.size === WORDS.length){
        statusMsg.textContent = 'üéâ Alle W√∂rter gefunden!';
      }
    }

    function addPointerEvents(){
      // Maus
      gridEl.addEventListener('mousedown', onPointerDown);
      window.addEventListener('mousemove', onPointerMove);
      window.addEventListener('mouseup', onPointerUp);
      // Touch
      gridEl.addEventListener('touchstart', (e)=>onPointerDown(e.changedTouches[0]), {passive:false});
      gridEl.addEventListener('touchmove',  (e)=>onPointerMove(e.changedTouches[0]), {passive:false});
      gridEl.addEventListener('touchend',   (e)=>onPointerUp(e.changedTouches[0]), {passive:false});
    }

    /***********************
     * 6) Init & Reset
     ***********************/
    function init(){
      data = buildGrid(WORDS);
      foundWords = new Set();
      render();
      addPointerEvents();
      statusMsg.textContent = `0/${WORDS.length} gefunden`;
    }

    resetBtn.addEventListener('click', init);

    init();
  </script>
</body>
</html>
