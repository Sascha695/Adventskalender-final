<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Adventskalender Tag 5</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Tag&nbsp;5 ‚Äì Mini-Sudoku</h1>
  </header>
  <main class="puzzle-container">
    <p>Die Elfen haben leider den Schl√ºssel zur Geschenkefabrik verloren und das so kurz vor Weihnachten. Das Schloss ist mit einem Zahlenr√§tsel versehen. Kannst du das Sudoku l√∂sen, dass die Produktion weiterlaufen kann?</p>
    <table class="sudoku" id="sudokuBoard"></table>
    <button onclick="checkSudoku()">√úberpr√ºfen</button>
    <div id="sudokuFeedback" style="color:red; margin-top:10px;"></div>
    <div id="letter-container" class="letter-container" style="display:none;">
      <p>Dein Buchstabe:</p>
      <div class="letter" id="letter"></div>
      <p>Merke dir diesen Buchstaben!</p>
    </div>
  </main>
 
 <style>
  .sudoku {
    width: min(92vw, 520px);
    aspect-ratio: 1/1;
    margin: 1.5rem auto;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(9, 1fr);
    gap: 0; 
    border: 4px solid #000;
    border-radius: 10px;
    overflow: hidden;
    background: rgba(255,255,255,0.18);
    backdrop-filter: blur(6px);
    box-shadow: 0 8px 26px rgba(0,0,0,.25);
  }
  .cell {
    position: relative;
    border: 1px solid #000;
  }
  /* dicke 3x3-Block-Grenzen */
  .cell:nth-child(3n+1) { }
  .cell { border-right-width: 1px; }
  .cell { border-bottom-width: 1px; }
  .cell[data-c="0"], .cell[data-c="3"], .cell[data-c="6"] { border-left-width: 3px; }
  .cell[data-r="0"], .cell[data-r="3"], .cell[data-r="6"] { border-top-width: 3px; }
  .cell[data-c="8"] { border-right-width: 3px; }
  .cell[data-r="8"] { border-bottom-width: 3px; }

  .prefilled, .cell input {
    width: 100%; height: 100%;
    display: grid; place-items: center;
    font: 600 1.1rem/1.1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color: #222;
    background: transparent;
  }
  .prefilled {
    color: #111;
  }
  .cell input {
    text-align: center;
    border: none;
    outline: none;
    -moz-appearance: textfield;
  }
  .cell input::-webkit-outer-spin-button,
  .cell input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .cell input:focus { box-shadow: inset 0 0 0 2px rgba(0,0,0,.25); }
  .error { background: rgba(255, 0, 0, 0.15) !important; }
  .ok    { background: rgba(0, 200, 0, 0.12) !important; }
</style>

<div id="sudoku" class="sudoku"></div>
<div style="text-align:center;margin:.75rem 0">
  <button type="button" onclick="checkSudoku()">√úberpr√ºfen</button>
  <span id="sudokuMsg" style="margin-left:.75rem;color:#222"></span>
</div>

<script>
/* ========= 1) Puzzle-Vorgaben (0 = leer) =========
   Diese Werte bilden dein gesendetes Sudoku ab.
   Du kannst einzelne Zahlen hier leicht √§ndern, falls n√∂tig. */
const puzzle = [
  [0,0,7,0,9,0,3,0,0],
  [0,6,8,0,0,0,9,2,0],
  [0,3,0,0,2,0,1,0,8],
  [0,7,0,0,9,0,2,4,0],
  [3,0,0,0,0,5,0,0,0],
  [5,9,0,0,0,7,0,0,0],
  [0,0,0,0,2,0,0,9,0],
  [8,0,0,0,5,0,4,0,0],
  [0,1,0,0,4,0,6,0,0],
];

/* ========= 2) Rendering ========= */
const root = document.getElementById('sudoku');
const inputs = []; // gleiche Struktur wie puzzle
for (let r = 0; r < 9; r++) {
  inputs[r] = [];
  for (let c = 0; c < 9; c++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.r = r; cell.dataset.c = c;

    if (puzzle[r][c] !== 0) {
      const s = document.createElement('div');
      s.className = 'prefilled';
      s.textContent = puzzle[r][c];
      cell.appendChild(s);
      inputs[r][c] = null;
    } else {
      const inp = document.createElement('input');
      inp.inputMode = 'numeric';
      inp.maxLength = 1;
      inp.placeholder = '';
      inp.addEventListener('input', (e) => {
        // nur 1..9 erlauben
        const v = e.target.value.replace(/[^1-9]/g,'');
        e.target.value = v.slice(0,1);
      });
      cell.appendChild(inp);
      inputs[r][c] = inp;
    }
    root.appendChild(cell);
  }
}

/* ========= 3) Solver (Backtracking) ========= */
function solve(grid) {
  const findEmpty = () => {
    for (let r=0;r<9;r++) for (let c=0;c<9;c++)
      if (grid[r][c] === 0) return [r,c];
    return null;
  };
  const isSafe = (r,c,val) => {
    for (let i=0;i<9;i++) if (grid[r][i]===val || grid[i][c]===val) return false;
    const br = Math.floor(r/3)*3, bc = Math.floor(c/3)*3;
    for (let i=0;i<3;i++) for (let j=0;j<3;j++)
      if (grid[br+i][bc+j]===val) return false;
    return true;
  };
  const step = () => {
    const pos = findEmpty();
    if (!pos) return true;
    const [r,c] = pos;
    for (let v=1; v<=9; v++) {
      if (isSafe(r,c,v)) {
        grid[r][c]=v;
        if (step()) return true;
        grid[r][c]=0;
      }
    }
    return false;
  };
  return step();
}

/* ========= 4) Check-Button ========= */
function readUserGrid() {
  const g = puzzle.map(row => row.slice());
  for (let r=0;r<9;r++) for (let c=0;c<9;c++) {
    if (puzzle[r][c]===0) {
      const v = inputs[r][c].value ? parseInt(inputs[r][c].value,10) : 0;
      g[r][c] = v;
    }
  }
  return g;
}

function checkSudoku() {
  // L√∂sung berechnen (einmalig je Klick)
  const solution = puzzle.map(row => row.slice());
  if (!solve(solution)) {
    document.getElementById('sudokuMsg').textContent = 'Dieses Sudoku ist nicht l√∂sbar.';
    return;
  }

  // Nutzereingaben vergleichen
  const user = readUserGrid();
  let allFilled = true, allCorrect = true;

  for (let r=0;r<9;r++) for (let c=0;c<9;c++) {
    const cellDiv = root.children[r*9 + c];
    cellDiv.classList.remove('error','ok');

    if (puzzle[r][c]===0) {
      const val = user[r][c];
      if (val===0) allFilled = false;
      if (val!==0 && val!==solution[r][c]) {
        allCorrect = false;
        cellDiv.classList.add('error');
      } else if (val!==0) {
        cellDiv.classList.add('ok');
      }
    }
  }

  const msg = document.getElementById('sudokuMsg');
  if (allCorrect && allFilled) {
    msg.style.color = 'green';
    msg.textContent = 'üéâ Richtig gel√∂st! Dein Buchstabe: E';
    // hier k√∂nntest du optional showLetter('E') aufrufen
  } else if (!allFilled) {
    msg.style.color = '#222';
    msg.textContent = 'Es sind noch Felder leer ‚Äì weiterknobeln üòä';
  } else {
    msg.style.color = 'crimson';
    msg.textContent = 'Da ist noch etwas falsch. Fehler sind rot markiert.';
  }
}
</script>

    const board = document.getElementById('sudokuBoard');
    for (let r = 0; r < 4; r++) {
      const row = document.createElement('tr');
      for (let c = 0; c < 4; c++) {
        const cell = document.createElement('td');
        const key = `${r}-${c}`;
        if (prefilled[key]) {
          cell.textContent = prefilled[key];
          cell.classList.add('prefilled');
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.maxLength = 1;
          cell.appendChild(input);
        }
        row.appendChild(cell);
      }
      board.appendChild(row);
    }
    function checkSudoku() {
      let correct = true;
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          const key = `${r}-${c}`;
          let value;
          if (prefilled[key]) {
            value = prefilled[key];
          } else {
            const inp = board.rows[r].cells[c].querySelector('input');
            value = parseInt(inp.value);
          }
          if (value !== solution[r][c]) {
            correct = false;
          }
        }
      }
      if (correct) {
        document.getElementById('sudokuFeedback').textContent = '';
        showLetter('H');
      } else {
        document.getElementById('sudokuFeedback').textContent = 'Mindestens eine Zahl ist falsch. Versuche es nochmal!';
      }
    }
    function showLetter(letter) {
      const container = document.getElementById('letter-container');
      document.getElementById('letter').textContent = letter;
      container.style.display = 'block';
    }
  </script>
</body>
</html>
